% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/analysis.R
\name{run_abrm}
\alias{run_abrm}
\title{Run ABRM Analysis}
\usage{
run_abrm(
  gridx,
  gridy,
  atoms,
  model_code,
  true_params = NULL,
  norm_idx_x = NULL,
  pois_idx_x = NULL,
  binom_idx_x = NULL,
  norm_idx_y = NULL,
  pois_idx_y = NULL,
  binom_idx_y = NULL,
  dist_y = 2,
  niter = 50000,
  nburnin = 30000,
  nchains = 2,
  thin = 10,
  seed = NULL,
  sim_metadata = NULL,
  save_plots = FALSE,
  output_dir = NULL,
  compute_waic = FALSE
)
}
\arguments{
\item{gridx}{The X-grid sf dataframe, containing a numeric area ID variable named 'ID' and covariates named 'covariate_x_1','covariate_x_2',...}

\item{gridy}{The Y-grid sf dataframe, containing a numeric area ID variable named 'ID', covariates named 'covariate_y_1','covariate_y_2',...., and an outcome named 'y'.}

\item{atoms}{The atom sf dataframe, which should contain numeric variables named 'ID_x' and 'ID_y' holding the X-grid and Y-grid cell IDs for each atom, as well as an atom-level population count named 'population'.}

\item{model_code}{NIMBLE model code from get_abrm_model()}

\item{true_params}{The true outcome model regression coefficient parameters, if known (e.g., from simulate_misaligned_data())}

\item{norm_idx_x}{Vector of numeric indices of X-grid covariates (ordered as 'covariate_x_1','covariate_x_2',...) that should be treated as normally-distributed}

\item{pois_idx_x}{Vector of numeric indices of X-grid covariates (ordered as 'covariate_x_1','covariate_x_2',...) that should be treated as Poisson-distributed}

\item{binom_idx_x}{Vector of numeric indices of X-grid covariates (ordered as 'covariate_x_1','covariate_x_2',...) that should be treated as binomial-distributed}

\item{norm_idx_y}{Vector of numeric indices of Y-grid covariates (ordered as 'covariate_y_1','covariate_y_2',...) that should be treated as normally-distributed}

\item{pois_idx_y}{Vector of numeric indices of Y-grid covariates (ordered as 'covariate_y_1','covariate_y_2',...) that should be treated as Poisson-distributed}

\item{binom_idx_y}{Vector of numeric indices of Y-grid covariates (ordered as 'covariate_y_1','covariate_y_2',...) that should be treated as binomial-distributed}

\item{dist_y}{Distribution type for outcome (1=normal, 2=poisson, 3=binomial)}

\item{niter}{Number of MCMC iterations (default: 50000)}

\item{nburnin}{Number of burn-in iterations (default: 30000)}

\item{nchains}{Number of MCMC chains (default: 2)}

\item{thin}{Thinning interval (default: 10)}

\item{seed}{Integer seed for reproducibility. Each chain uses seed+(chain_number-1) (default: NULL)}

\item{sim_metadata}{Optional simulation metadata list}

\item{save_plots}{Logical, whether to save diagnostic plots (default: FALSE)}

\item{output_dir}{Directory for saving outputs (default: NULL)}

\item{compute_waic}{Logical; if \code{TRUE}, NIMBLE computes the Widely
Applicable Information Criterion (WAIC) during MCMC sampling and stores it
in the returned object. Retrieve it afterwards with \code{\link{waic}}.
Default \code{FALSE}.}
}
\value{
An object of class \code{"abrm"}: a named list with components \code{mcmc_results} (raw NIMBLE output including posterior samples and convergence diagnostics), 
\code{parameter_estimates} (data frame of posterior summaries for the regression coefficients), and \code{all_parameters} (posterior summaries for all monitored parameters). 
Use \code{print()}, \code{summary()}, \code{plot()}, and \code{vcov()} to inspect the fitted model.
}
\description{
Runs the Atom-Based Regression Model on simulated data
}
\examples{
\donttest{
  # Simulate misaligned spatial data with one normal covariate per grid
  sim_data <- simulate_misaligned_data(
    seed = 1,
    dist_covariates_x = "normal",
    dist_covariates_y = "normal",
    dist_y = "normal",
    x_intercepts = 0,
    y_intercepts = 0,
    beta0_y = 0,
    beta_x = 0.1,
    beta_y = -0.1
  )

  # Retrieve the pre-compiled NIMBLE model code
  model_code <- get_abrm_model()

  # Fit the ABRM (use small niter/nburnin for illustration only)
  results <- run_abrm(
    gridx      = sim_data$gridx,
    gridy      = sim_data$gridy,
    atoms      = sim_data$atoms,
    model_code = model_code,
    true_params = sim_data$true_params,
    norm_idx_x = 1,
    norm_idx_y = 1,
    dist_y     = 1,
    niter      = 1000,
    nburnin    = 500,
    nchains    = 2,
    seed       = 1,
    save_plots = FALSE
  )

  print(results)    # concise model summary
  summary(results)  # full parameter table
  plot(results)     # MCMC trace and density plots
  vcov(results)     # posterior variance-covariance matrices
}

}
