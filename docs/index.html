<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Spatial Analysis with Misaligned Data Using Atom-Based Regression Models • spatialAtomizeR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="48x48" href="favicon-48x48.png">
<link rel="icon" type="”image/svg+xml”" href="favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
<link rel="icon" sizes="any" href="favicon.ico">
<link rel="manifest" href="site.webmanifest">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Spatial Analysis with Misaligned Data Using Atom-Based Regression Models">
<meta property="og:description" content="Implements atom-based regression models (ABRM) for analyzing spatially misaligned data. Provides functions for simulating misaligned spatial data, preparing NIMBLE model inputs, running MCMC diagnostics, and comparing different spatial analysis methods including dasymetric mapping. Oct 22 Updates: Updated codes for warnings">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">spatialAtomizeR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/getting-started.html">Getting Started with spatialAtomizeR</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/bellayqian/spatialAtomizeR/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="contents col-md-9">
<div class="section level1">
<div class="page-header"><h1 id="spatialatomizer-">spatialAtomizeR <img src="reference/figures/logo.png" align="right" height="120" alt=""><a class="anchor" aria-label="anchor" href="#spatialatomizer-"></a>
</h1></div>
<p>Bayesian Spatial Regression with Misaligned Data</p>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p><code>spatialAtomizeR</code> implements atom-based Bayesian regression methods (ABRM) for spatial data with misaligned grids. The package handles situations where:</p>
<ul>
<li>Outcome data and covariates are available on different spatial grids</li>
<li>The spatial grids are non-nested (misaligned)</li>
<li>Variables follow different distributions (normal, Poisson, binomial)</li>
</ul>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the development version from GitHub:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"bellayqian/spatialAtomizeR"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="quick-start">Quick Start<a class="anchor" aria-label="anchor" href="#quick-start"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bellayqian/spatialAtomizeR" class="external-link">spatialAtomizeR</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 1. Simulate misaligned spatial data</span></span>
<span><span class="va">sim_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/simulate_misaligned_data.html">simulate_misaligned_data</a></span><span class="op">(</span></span>
<span>  seed <span class="op">=</span> <span class="fl">42</span>,</span>
<span>  res1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span>,  <span class="co"># Y grid resolution</span></span>
<span>  res2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span>, <span class="co"># X grid resolution</span></span>
<span>  dist_covariates_x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'normal'</span>, <span class="st">'poisson'</span>, <span class="st">'binomial'</span><span class="op">)</span>,</span>
<span>  dist_covariates_y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'normal'</span>, <span class="st">'poisson'</span>, <span class="st">'binomial'</span><span class="op">)</span>,</span>
<span>  dist_y <span class="op">=</span> <span class="st">'poisson'</span>,</span>
<span>  x_correlation <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  y_correlation <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  beta_x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.03</span>, <span class="fl">0.1</span>, <span class="op">-</span><span class="fl">0.2</span><span class="op">)</span>,</span>
<span>  beta_y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.03</span>, <span class="op">-</span><span class="fl">0.1</span>, <span class="fl">0.2</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2. Get NIMBLE model code</span></span>
<span><span class="va">model_code</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_abrm_model.html">get_abrm_model</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 3. Run ABRM</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/run_abrm.html">run_abrm</a></span><span class="op">(</span></span>
<span>  sim_data <span class="op">=</span> <span class="va">sim_data</span>,</span>
<span>  model_code <span class="op">=</span> <span class="va">model_code</span>,</span>
<span>  norm_idx_x <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  pois_idx_x <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  binom_idx_x <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  norm_idx_y <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  pois_idx_y <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  binom_idx_y <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  dist_y <span class="op">=</span> <span class="fl">2</span>,  <span class="co"># 1=normal, 2=poisson, 3=binomial</span></span>
<span>  niter <span class="op">=</span> <span class="fl">50000</span>,</span>
<span>  nburnin <span class="op">=</span> <span class="fl">30000</span>,</span>
<span>  nchains <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 4. View results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">parameter_estimates</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="main-features">Main Features<a class="anchor" aria-label="anchor" href="#main-features"></a>
</h2>
<div class="section level3">
<h3 id="data-simulation">Data Simulation<a class="anchor" aria-label="anchor" href="#data-simulation"></a>
</h3>
<ul>
<li>Generate spatially correlated variables with customizable distributions</li>
<li>Create non-nested misaligned spatial grids</li>
<li>Specify true parameter values for validation</li>
</ul>
</div>
<div class="section level3">
<h3 id="model-fitting">Model Fitting<a class="anchor" aria-label="anchor" href="#model-fitting"></a>
</h3>
<ul>
<li>Atom-based Bayesian regression with NIMBLE</li>
<li>Support for mixed-type variables (normal, Poisson, binomial)</li>
<li>Multivariate CAR models for spatial correlation</li>
<li>Automatic convergence diagnostics</li>
</ul>
</div>
<div class="section level3">
<h3 id="method-comparison">Method Comparison<a class="anchor" aria-label="anchor" href="#method-comparison"></a>
</h3>
<ul>
<li>Compare ABRM with dasymetric mapping</li>
<li>Calculate bias, RMSE, and coverage rates</li>
<li>Generate comparison plots</li>
</ul>
</div>
<div class="section level3">
<h3 id="sensitivity-analysis">Sensitivity Analysis<a class="anchor" aria-label="anchor" href="#sensitivity-analysis"></a>
</h3>
<ul>
<li>Test across different correlation structures</li>
<li>Multiple simulations per setting</li>
<li>Automated result summarization</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="key-functions">Key Functions<a class="anchor" aria-label="anchor" href="#key-functions"></a>
</h2>
<table class="table">
<thead><tr>
<th>Function</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr>
<td><code><a href="reference/simulate_misaligned_data.html">simulate_misaligned_data()</a></code></td>
<td>Generate simulated spatial data</td>
</tr>
<tr>
<td><code><a href="reference/get_abrm_model.html">get_abrm_model()</a></code></td>
<td>Get NIMBLE model specification</td>
</tr>
<tr>
<td><code><a href="reference/run_abrm.html">run_abrm()</a></code></td>
<td>Run ABRM analysis</td>
</tr>
<tr>
<td><code><a href="reference/run_both_methods.html">run_both_methods()</a></code></td>
<td>Compare ABRM and dasymetric mapping</td>
</tr>
<tr>
<td><code><a href="reference/run_sensitivity_analysis.html">run_sensitivity_analysis()</a></code></td>
<td>Conduct sensitivity analysis</td>
</tr>
<tr>
<td><code><a href="reference/prepare_spatial_bookkeeping.html">prepare_spatial_bookkeeping()</a></code></td>
<td>Prepare spatial indices</td>
</tr>
<tr>
<td><code><a href="reference/prepare_nimble_inputs.html">prepare_nimble_inputs()</a></code></td>
<td>Prepare NIMBLE model inputs</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="example-workflow">Example Workflow<a class="anchor" aria-label="anchor" href="#example-workflow"></a>
</h2>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Sensitivity analysis across correlation structures</span></span>
<span><span class="va">sensitivity_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/run_sensitivity_analysis.html">run_sensitivity_analysis</a></span><span class="op">(</span></span>
<span>  correlation_grid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.6</span><span class="op">)</span>,</span>
<span>  n_sims_per_setting <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  model_code <span class="op">=</span> <span class="fu"><a href="reference/get_abrm_model.html">get_abrm_model</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  base_seed <span class="op">=</span> <span class="fl">123</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View summary</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sensitivity_results</span><span class="op">$</span><span class="va">summary_by_correlation</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="requirements">Requirements<a class="anchor" aria-label="anchor" href="#requirements"></a>
</h2>
<ul>
<li>R &gt;= 4.0.0</li>
<li>NIMBLE for MCMC sampling</li>
<li>Spatial packages: sp, sf, spdep</li>
<li>BiasedUrn for multivariate hypergeometric sampling</li>
</ul>
</div>
<div class="section level2">
<h2 id="funding-and-project-information">Funding and Project Information<a class="anchor" aria-label="anchor" href="#funding-and-project-information"></a>
</h2>
<p>This work was funded by the Robert Wood Johnson Foundation, Grant 81746. Project details are provided below.</p>
<p><strong>Project Title:</strong> Aligning spatially misaligned data for health equity analysis, action, and accountability</p>
<p><strong>Principal Investigators:</strong> Dr. Nancy Krieger (PI) and Dr. Rachel Nethery (co-PI)</p>
<p><strong>Start Date:</strong> July 2024</p>
<p><strong>Project Team and Collaborators:</strong> - Yunzhe Qian (Bella), MS (Research Assistant, Dept of Biostatistics, HSPH) - Rachel Nethery, PhD (Assistant Professor, Dept of Biostatistics, HSPH) - Nancy Krieger, PhD (Professor, Department of Social and Behavioral Sciences (SBS), HSPH) - Nykesha Johnson, MPH (Statistical Data Analyst/Data Manager, SBS, HSPH)</p>
</div>
<div class="section level2">
<h2 id="citation">Citation<a class="anchor" aria-label="anchor" href="#citation"></a>
</h2>
<p>If you use this package, please cite:</p>
<p>Qian, Y., &amp; Nethery, R. (2025). spatialAtomizeR: Atom-Based Regression Models for Misaligned Spatial Data. R package version 0.2.0.</p>
</div>
<div class="section level2">
<h2 id="about">About<a class="anchor" aria-label="anchor" href="#about"></a>
</h2>
<p>This work is an extension of:</p>
<p>Nethery, R. C., Testa, C., Tabb, L. P., Hanage, W. P., Chen, J. T., &amp; Krieger, N. (2023). Addressing spatial misalignment in population health research: a case study of US congressional district political metrics and county health data. MedRxiv.</p>
<p>Spatial misalignment—which occurs when data on multiple variables are collected using mismatched geographic boundary definitions—is a longstanding challenge in public health research. For instance, congressional districts can cut across multiple counties, and environmental hazard zones may cross census tract boundaries, in both cases creating intersecting areas that complicate efforts to study the relationships between health outcomes and their social, political, and environmental determinants.</p>
<p>Atom-based regression models (ABRM) offer a promising alternative by using atoms, the intersecting areas of all relevant units, as the fundamental units of analysis. By preserving the original spatial resolution of the data, ABRM account for uncertainty in statistical relationships while offering a robust method for handling misaligned data.</p>
</div>
<div class="section level2">
<h2 id="getting-help">Getting Help<a class="anchor" aria-label="anchor" href="#getting-help"></a>
</h2>
<ul>
<li>Report bugs at: <a href="https://github.com/bellayqian/spatialAtomizeR/issues" class="external-link uri">https://github.com/bellayqian/spatialAtomizeR/issues</a>
</li>
<li>Check documentation: <code><a href="reference/spatialAtomizeR-package.html">?spatialAtomizeR</a></code>
</li>
<li>See vignette: <code><a href="articles/getting-started.html">vignette("getting-started", package = "spatialAtomizeR")</a></code>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="license">License<a class="anchor" aria-label="anchor" href="#license"></a>
</h2>
<p>MIT License</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/bellayqian/spatialAtomizeR/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/bellayqian/spatialAtomizeR/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li>
<a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing spatialAtomizeR</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Yunzhe Qian <br><small class="roles"> Author, maintainer </small>   </li>
<li>Rachel Nethery <br><small class="roles"> Author </small>   </li>
</ul>
</div>



  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Yunzhe Qian, Rachel Nethery.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer>
</div>






  </body>
</html>
